---
import SiteLayout from '../../layouts/SiteLayout.astro'
import { getTournament } from '../../lib/tournaments'
import TournamentBracketClient from '../../components/TournamentBracketClient'
import { getLangCookie, resolveLang, setLangCookie, getTournamentStatus, tServer } from '@/i18n'
import type { Lang } from '@/i18n'

const { id } = Astro.params
if (!id) throw new Error('Missing tournament id')

const existingCookie = getLangCookie(Astro)
const lang: Lang = resolveLang({ url: Astro.url, req: Astro.request, cookie: existingCookie ?? undefined })
if (existingCookie !== lang) {
  setLangCookie(Astro, lang)
}

const tournament = await getTournament(id)
const statusLabel = getTournamentStatus(tournament.status, lang)
---
<SiteLayout title={tournament.name}>
  <section class="tournament-detail-page">
    <div class="tournament-detail-page__container">
      <div class="tournament-detail-page__header">
        <a href="/t" class="tournament-detail-page__back">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          <span>{tServer(lang, 'tournaments.backToList')}</span>
        </a>
        
        <div class="tournament-detail-page__title-row">
          <h1 class="tournament-detail-page__heading">{tournament.name}</h1>
          <span class={`tournament-detail-page__status tournament-detail-page__status--${tournament.status}`}>
            {statusLabel}
          </span>
        </div>
      </div>

      <TournamentBracketClient tournamentId={id} lang={lang} client:only="react" />
    </div>
  </section>
</SiteLayout>
